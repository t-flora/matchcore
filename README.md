# MatchCore

A high-performance matching engine built with C++ and Liquibook.

## Project Structure

```
matchcore/
├── docker/                 # Container definitions
│   ├── base/              # Base development environment
│   ├── liquibook/         # Liquibook dependency container
│   ├── matchcore/         # Main project container
│   └── dev/               # Development environment
├── external/              # External dependencies
│   ├── liquibook/         # Liquibook order book implementation
│   └── MPC/               # Make Project Creator
├── scripts/               # Build and test scripts
├── src/                   # Source code
└── docker-compose.yml     # Container orchestration
```

## Quick Start

### Prerequisites

- Docker
- Docker Compose

### Building and Testing

1. **Build all containers:**
   ```bash
   ./scripts/build.sh
   ```

2. **Run all tests:**
   ```bash
   ./scripts/test.sh
   ```

3. **Start development environment:**
   ```bash
   docker compose run dev bash
   ```

## Container Architecture

### Base Container (`matchcore-base`)
- Ubuntu 22.04 base
- Build tools (gcc, cmake, make)
- Boost 1.88.0 compiled from source
- All necessary development libraries

### Liquibook Container (`matchcore-liquibook`)
- Built on top of base container
- Liquibook source code and MPC
- Pre-built Liquibook library and tests
- Unit tests, performance tests, and latency tests

### MatchCore Container (`matchcore`)
- Built on top of Liquibook container
- Main project source code
- CMake build system
- Links against built Liquibook library

### Development Container (`matchcore-dev`)
- Interactive development environment
- Additional debugging tools (gdb, valgrind, cppcheck)
- Helper scripts and aliases
- Mounted source code for live development

## Development Workflow

### Inside Development Container

The development container provides several helpful commands:

```bash
# Show available commands
help

# Rebuild Liquibook
build-liquibook

# Run Liquibook tests
test-liquibook

# Build MatchCore
build-matchcore

# Run MatchCore tests
test-matchcore

# Clean all builds
clean
```

### Adding New Dependencies

1. **Update base container** (`docker/base/Dockerfile`):
   - Add system packages
   - Install from source if needed

2. **Update dependency containers**:
   - Add dependency to appropriate container
   - Update build scripts
   - Add tests

3. **Update CMakeLists.txt**:
   - Add find_package calls
   - Update include/link directories

### Running Individual Services

```bash
# Run only Liquibook tests
docker compose up liquibook

# Run only MatchCore tests
docker compose up matchcore

# Start development environment
docker compose run dev bash
```

## Troubleshooting

### Common Issues

1. **Build failures:**
   - Check Docker has enough memory (recommend 4GB+)
   - Ensure all source files are present
   - Check environment variables in containers

2. **Test failures:**
   - Run tests individually to isolate issues
   - Check Liquibook test output for specific failures
   - Verify Boost installation in base container

3. **Permission issues:**
   - Ensure scripts are executable: `chmod +x scripts/*.sh`
   - Check Docker volume permissions

### Debugging

1. **Interactive debugging:**
   ```bash
   docker compose run dev bash
   gdb ./build/bin/matchcore
   ```

2. **Memory checking:**
   ```bash
   docker compose run dev bash
   valgrind ./build/bin/matchcore
   ```

3. **Static analysis:**
   ```bash
   docker compose run dev bash
   cppcheck src/
   ```

## Architecture Notes

### Dependency Management

- **Boost**: Compiled from source in base container
- **Liquibook**: Built using MPC in dedicated container
- **MPC**: Used for Liquibook build system generation

### Build System

- **CMake**: Main project build system
- **MPC**: Liquibook dependency build system
- **Make**: Generated by MPC for Liquibook

### Testing Strategy

- **Unit Tests**: Liquibook unit tests run in isolation
- **Integration Tests**: MatchCore tests with built dependencies
- **Performance Tests**: Liquibook performance and latency tests

## Contributing

1. Make changes in development container
2. Run tests to ensure nothing breaks
3. Update documentation as needed
4. Submit pull request

## License

[Add your license information here] 